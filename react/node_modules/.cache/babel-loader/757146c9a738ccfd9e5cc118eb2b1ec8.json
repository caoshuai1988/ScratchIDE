{"ast":null,"code":"var _jsxFileName = \"/Users/dongbo/Desktop/react/src/pages/display/display.jsx\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport ClassCropperModal from '../../components/class-cropper-modal/class-cropper-modal';\nimport { http } from '../../api/api';\nimport { Modal } from 'antd';\nimport 'antd/dist/antd.css';\nimport './display.scss';\nimport { hidden } from 'ansi-colors';\n\nconst tsIcon = require('../../images/dui.png');\n\nconst jia = require('../../images/add.png');\n\nconst bgc = require('../../images/bgc.jpg');\n\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 文件最大限制为5M\n\nclass Display extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChange = event => {\n      this.setState({\n        title: event.target.value\n      });\n    };\n\n    this.allContent = event => {\n      this.setState({\n        content: event.target.value\n      });\n    };\n\n    this.checkboxOption = event => {\n      this.setState({\n        choose: event.target.value\n      });\n    };\n\n    this.dataURLtoFile = (dataurl, filename) => {\n      //将base64转换为文件\n      console.log(dataurl, '-=-=-=-');\n      var arr = dataurl.split(','),\n          mime = arr[0].match(/:(.*?);/)[1],\n          bstr = atob(arr[1]),\n          n = bstr.length,\n          u8arr = new Uint8Array(n);\n\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n\n      return new File([u8arr], filename, {\n        type: mime\n      });\n    };\n\n    this.newPage = () => {\n      window.open(\"http://127.0.0.1:8601?type=3&autoPlay=1&url=\".concat(this.state.url));\n    };\n\n    this.submitAll = () => {\n      if (this.state.content === '') {\n        this.info();\n        return;\n      }\n\n      if (this.state.title === '') {\n        this.setState({\n          titleTxt: '无标题',\n          titleContent: '请输入标题'\n        });\n        this.info();\n        return;\n      }\n\n      if (this.state.classResultImgUrl === null) {\n        this.setState({\n          titleTxt: '无封面图片',\n          titleContent: '请上传封面图片'\n        });\n        this.info();\n        return;\n      } // let _this = this\n      // let filedata = ''\n      // let dataurl = ''\n      // let reader = new FileReader();\n      // reader.readAsDataURL(this.state.classModalFile);\n      // reader.onload = function (e){ \n      //     //  filedata= this.result.substring(this.result.indexOf(',')+1);\n      //      filedata= this.result;\n      //      console.log(filedata,'-=-=-=-')\n      //      dataurl =  this.result.substring;\n      //      let a = _this.dataURLtoFile(filedata)\n      //      console.log(a,'-=-=-')\n      // }\n\n\n      http.post('http://kejiadmin.qbitai.com/index.php?r=publish/preview', {\n        file: this.state.classModalFile,\n        id: this.state.id,\n        classResultImgUrl: this.state.classResultImgUrl,\n        title: this.state.title,\n        choose: this.state.choose,\n        content: this.state.content\n      }).then(data => {\n        this.props.history.push(\"/showVideo/\".concat(this.state.url));\n      }).catch(err => console.log(err));\n    };\n\n    this.info = () => {\n      Modal.info({\n        title: this.state.titleTxt,\n        content: React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 147\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 148\n          },\n          __self: this\n        }, this.state.titleContent)),\n\n        onOk() {}\n\n      });\n    };\n\n    this.handleClassFileChange = e => {\n      const file = e.target.files[0];\n\n      if (file) {\n        if (file.size <= MAX_FILE_SIZE) {\n          this.setState({\n            classModalFile: file // 先把上传的文件暂存在state中\n\n          }, () => {\n            this.setState({\n              classModalVisible: true // 然后弹出modal\n\n            });\n          });\n        } else {\n          console.log('文件过大');\n        }\n      }\n    };\n\n    this.handleGetResultImgUrl = key => blob => {\n      const str = URL.createObjectURL(blob);\n      this.setState({\n        [key]: str\n      });\n    };\n\n    this.state = {\n      classModalVisible: false,\n      classModalFile: null,\n      classResultImgUrl: null,\n      title: '',\n      choose: '0',\n      content: '',\n      titleTxt: '无内容',\n      titleContent: '无内容',\n      url: '',\n      id: '',\n      base64: ''\n    };\n  }\n\n  componentDidMount() {\n    //获取路由参数\n    let urlRouter = this.props.location.search;\n    let theRequest = {};\n\n    if (urlRouter.indexOf(\"?\") !== -1) {\n      let strs = urlRouter.substr(1);\n      strs = strs.split(\"&\");\n\n      for (let i = 0; i < strs.length; i++) {\n        theRequest[strs[i].split(\"=\")[0]] = unescape(strs[i].split(\"=\")[1]);\n      }\n    }\n\n    this.setState({\n      id: theRequest.id,\n      url: theRequest.url\n    });\n  }\n\n  render() {\n    const _this$state = this.state,\n          classModalVisible = _this$state.classModalVisible,\n          classModalFile = _this$state.classModalFile,\n          classResultImgUrl = _this$state.classResultImgUrl;\n    return React.createElement(\"div\", {\n      className: \"content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: bgc,\n      alt: \"\",\n      style: {\n        width: '100%',\n        height: '100%'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"con-box\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      className: \"fa\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192\n      },\n      __self: this\n    }, \"\\u53D1\\u5E03\\u4F5C\\u54C1\"), React.createElement(\"div\", {\n      className: \"line\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"flex-box\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"production\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"zuo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }, \"\\u4F5C\\u54C1\\u540D\\u79F0\"), React.createElement(\"input\", {\n      type: \"text\",\n      className: \"inputText\",\n      name: \"title\",\n      value: this.state.title,\n      onChange: this.handleChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"explain\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }, \"\\u4F5C\\u54C1\\u4ECB\\u7ECD\\u4E0E\\u64CD\\u4F5C\\u8BF4\\u660E\"), React.createElement(\"textarea\", {\n      id: \"\",\n      cols: \"30\",\n      rows: \"10\",\n      className: \"textAll\",\n      placeholder: \"\\u8FD9\\u91CC\\u53EF\\u4EE5\\u5411\\u5927\\u5BB6\\u4ECB\\u7ECD\\u4F60\\u7684\\u4F5C\\u54C1\\uFF5E\",\n      name: \"content\",\n      value: this.state.content,\n      onChange: this.allContent,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"select\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      className: \"left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"checkbox\",\n      className: \"hidden-input\",\n      name: \"choose\",\n      value: \"0\",\n      onChange: this.checkboxOption,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      className: \"your style about checkbox\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }), this.state.choose === '0' ? React.createElement(\"img\", {\n      src: tsIcon,\n      className: \"dui\",\n      alt: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }) : ''), React.createElement(\"div\", {\n      className: \"share\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    }, \"\\u516C\\u5F00\\u5206\\u4EAB\"), React.createElement(\"label\", {\n      className: \"left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"checkbox\",\n      className: \"hidden-input\",\n      name: \"choose\",\n      value: \"1\",\n      onChange: this.checkboxOption,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      className: \"your style about checkbox\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }), this.state.choose === '1' ? React.createElement(\"img\", {\n      src: tsIcon,\n      className: \"dui\",\n      alt: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    }) : ''), React.createElement(\"div\", {\n      className: \"share\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, \"\\u5141\\u8BB8\\u67E5\\u770B\\u6E90\\u4EE3\\u7801\"))), React.createElement(\"div\", {\n      className: \"cover\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"zuo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217\n      },\n      __self: this\n    }, \"\\u4F5C\\u54C1\\u5C01\\u9762\"), React.createElement(\"div\", {\n      className: \"imgAll\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }, classResultImgUrl ? React.createElement(\"div\", {\n      className: \"img-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223\n      },\n      __self: this\n    }, classResultImgUrl && React.createElement(\"img\", {\n      className: \"img\",\n      src: classResultImgUrl,\n      alt: \"classResultImgUrl\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225\n      },\n      __self: this\n    })) : '', React.createElement(\"div\", {\n      className: \"jia\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: jia,\n      alt: \"\",\n      className: \"fuhao\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"app\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"half-area\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      className: \"upload-input-label\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"file\",\n      accept: \"image/jpeg,image/jpg,image/png\",\n      className: \"base-upload-input\",\n      onChange: this.handleClassFileChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239\n      },\n      __self: this\n    }))))))))), React.createElement(\"div\", {\n      className: \"btn\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254\n      },\n      __self: this\n    }, classModalVisible && React.createElement(ClassCropperModal, {\n      uploadedImageFile: classModalFile,\n      onClose: () => {\n        this.setState({\n          classModalVisible: false\n        });\n      },\n      onSubmit: this.handleGetResultImgUrl('classResultImgUrl'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"buttom\",\n      onClick: this.submitAll,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264\n      },\n      __self: this\n    }, \"\\u63D0\\u4EA4\\u4F5C\\u54C1\")), React.createElement(\"button\", {\n      className: \"right-btn buttom isShow\",\n      onClick: this.newPage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }, \"\\u8FD4\\u56DE\\u7F16\\u8F91\"))));\n  }\n\n}\n\nDisplay.propTypes = {\n  classModalVisible: PropTypes.bool,\n  classModalFile: PropTypes.bool,\n  classResultImgUrl: PropTypes.string,\n  title: PropTypes.string,\n  choose: PropTypes.string,\n  content: PropTypes.string,\n  titleTxt: PropTypes.string,\n  titleContent: PropTypes.string\n};\nexport default Display;","map":{"version":3,"sources":["/Users/dongbo/Desktop/react/src/pages/display/display.jsx"],"names":["React","Component","PropTypes","ClassCropperModal","http","Modal","hidden","tsIcon","require","jia","bgc","MAX_FILE_SIZE","Display","constructor","props","handleChange","event","setState","title","target","value","allContent","content","checkboxOption","choose","dataURLtoFile","dataurl","filename","console","log","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","File","type","newPage","window","open","state","url","submitAll","info","titleTxt","titleContent","classResultImgUrl","post","file","classModalFile","id","then","data","history","push","catch","err","onOk","handleClassFileChange","e","files","size","classModalVisible","handleGetResultImgUrl","key","blob","str","URL","createObjectURL","base64","componentDidMount","urlRouter","location","search","theRequest","indexOf","strs","substr","i","unescape","render","width","height","propTypes","bool","string"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types'\nimport ClassCropperModal from '../../components/class-cropper-modal/class-cropper-modal'\nimport { http } from'../../api/api'\nimport { Modal } from 'antd';\nimport 'antd/dist/antd.css';\nimport './display.scss';\nimport { hidden } from 'ansi-colors';\nconst tsIcon = require('../../images/dui.png')\nconst jia = require('../../images/add.png')\nconst bgc = require('../../images/bgc.jpg')\nconst MAX_FILE_SIZE = 5 * 1024 * 1024 // 文件最大限制为5M\n\nclass Display extends Component {\n  static propTypes= {\n    classModalVisible: PropTypes.bool,\n    classModalFile: PropTypes.bool,\n    classResultImgUrl: PropTypes.string,\n    title: PropTypes.string,\n    choose: PropTypes.string,\n    content: PropTypes.string,\n    titleTxt:PropTypes.string,\n    titleContent:PropTypes.string,\n  }\n\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      classModalVisible: false,\n      classModalFile: null,\n      classResultImgUrl: null,\n      title: '',\n      choose:'0',\n      content:'',\n      titleTxt:'无内容',\n      titleContent: '无内容',\n      url:'',\n      id:'',\n      base64:''\n    }\n  }\n\n  componentDidMount () {\n    //获取路由参数\n    let urlRouter = this.props.location.search;\n    let  theRequest = {};\n    if (urlRouter.indexOf(\"?\") !== -1) {\n            let strs = urlRouter.substr(1);\n            strs = strs.split(\"&\");\n            for(let i = 0; i < strs.length; i ++) {\n            theRequest[strs[i].split(\"=\")[0]] = unescape(strs[i].split(\"=\")[1]);\n        }\n    }\n    this.setState({\n      id : theRequest.id,\n      url : theRequest.url\n    });\n  }\n\n  handleChange= (event) =>{\n      this.setState({\n        title: event.target.value\n      })\n  }\n\n  allContent= (event) =>{\n    this.setState({\n      content: event.target.value\n    })\n  }\n\n  checkboxOption= (event) =>{\n      this.setState({\n        choose:event.target.value\n      });\n  }\n\n  dataURLtoFile=(dataurl, filename) =>{//将base64转换为文件\n    console.log(dataurl,'-=-=-=-')\n    var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],\n        bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\n    while(n--){\n        u8arr[n] = bstr.charCodeAt(n);\n    }\n    return new File([u8arr], filename, {type:mime});\n  }\n\n  newPage= () =>{\n    window.open(`http://127.0.0.1:8601?type=3&autoPlay=1&url=${this.state.url}`)\n  }\n\n  submitAll = () =>{\n    if(this.state.content ===''){\n      this.info()\n      return\n    }\n    if(this.state.title ===''){\n      this.setState({\n        titleTxt : '无标题',\n        titleContent : '请输入标题'\n      });\n      this.info()\n      return\n    }\n    if(this.state.classResultImgUrl ===null){\n      this.setState({\n        titleTxt : '无封面图片',\n        titleContent : '请上传封面图片'\n      });\n      this.info()\n      return\n    }\n    // let _this = this\n    // let filedata = ''\n    // let dataurl = ''\n    // let reader = new FileReader();\n    // reader.readAsDataURL(this.state.classModalFile);\n    // reader.onload = function (e){ \n    //     //  filedata= this.result.substring(this.result.indexOf(',')+1);\n    //      filedata= this.result;\n    //      console.log(filedata,'-=-=-=-')\n    //      dataurl =  this.result.substring;\n    //      let a = _this.dataURLtoFile(filedata)\n    //      console.log(a,'-=-=-')\n    // }\n\n    http.post('http://kejiadmin.qbitai.com/index.php?r=publish/preview',{\n      file:this.state.classModalFile,\n      id:this.state.id,\n      classResultImgUrl: this.state.classResultImgUrl,\n      title: this.state.title,\n      choose:this.state.choose,\n      content:this.state.content,\n    },).then(\n        data => {\n          this.props.history.push( `/showVideo/${this.state.url}`)\n        }\n      )\n    .catch(err => console.log(err)) \n  }\n\n  info =() => {\n    Modal.info({\n      title: this.state.titleTxt,\n      content: (\n        <div>\n          <p>{this.state.titleContent}</p>\n        </div>\n      ),\n      onOk() {},\n    });\n  }\n\n  handleClassFileChange = e => {\n    const file = e.target.files[0]\n    if (file) {\n      if (file.size <= MAX_FILE_SIZE) {\n        this.setState(\n          {\n            classModalFile: file // 先把上传的文件暂存在state中\n          },\n          () => {\n            this.setState({\n              classModalVisible: true // 然后弹出modal\n            })\n          }\n        )\n      } else {\n        console.log('文件过大')\n      }\n    }\n  }\n\n  handleGetResultImgUrl = key => blob => {\n    const str = URL.createObjectURL(blob)\n    this.setState({\n      [key]: str\n    })\n  }\n\n  render() {\n    const {\n      classModalVisible,\n      classModalFile,\n      classResultImgUrl\n    } = this.state\n    return (\n      <div className=\"content\" >\n        <img src={bgc} alt=\"\"style={{width:'100%',height:'100%'}}  />\n          <div className=\"con-box\">\n              <span className=\"fa\">发布作品</span>\n              <div className=\"line\"></div>\n              <div className=\"flex-box\">\n                <div className=\"production\">\n                  <div className=\"zuo\">作品名称</div>\n                  <input type=\"text\" className=\"inputText\"  name='title' value={this.state.title}  onChange={this.handleChange} />\n                  <div className=\"explain\">作品介绍与操作说明</div>\n                  <textarea  id=\"\" cols=\"30\" rows=\"10\" className=\"textAll\" placeholder=\"这里可以向大家介绍你的作品～\" name='content' value={this.state.content}  onChange={this.allContent} ></textarea>\n                  <div className=\"select\">\n                    <label className=\"left\">\n                        <input type=\"checkbox\" className=\"hidden-input\" name='choose'  value='0' onChange={this.checkboxOption}/>\n                        <span className=\"your style about checkbox\" ></span>\n                        {this.state.choose ==='0' ? <img src={tsIcon} className=\"dui\" alt=\"\"/> : ''}\n                    </label>\n                    <div className=\"share\">公开分享</div>\n\n                    <label className=\"left\">\n                        <input type=\"checkbox\" className=\"hidden-input\" name='choose' value='1'  onChange={this.checkboxOption}/>\n                        <span className=\"your style about checkbox\"></span>\n                        {this.state.choose=== '1' ? <img src={tsIcon} className=\"dui\" alt=\"\"/> : ''}\n                    </label>\n                    <div className=\"share\">允许查看源代码</div>\n                  </div>\n                </div>\n                <div className=\"cover\">\n                  <div className=\"zuo\">作品封面</div>\n                  <div className=\"imgAll\">\n                    {/* <img className=\"imageWh\" src=\"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1561543101261&di=9e8f50486a2ab5d4c527800b3e224fbf&imgtype=0&src=http%3A%2F%2Fwx4.sinaimg.cn%2Fwap720%2F006JOJQuly1fsqmtu4fckj31bg0qoaf5.jpg\" alt=\"\"/>\n                    <img className=\"imageWh\" src=\"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1561543101261&di=9e8f50486a2ab5d4c527800b3e224fbf&imgtype=0&src=http%3A%2F%2Fwx4.sinaimg.cn%2Fwap720%2F006JOJQuly1fsqmtu4fckj31bg0qoaf5.jpg\" alt=\"\"/>\n                    <img className=\"imageWh\" src=\"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1561543101261&di=9e8f50486a2ab5d4c527800b3e224fbf&imgtype=0&src=http%3A%2F%2Fwx4.sinaimg.cn%2Fwap720%2F006JOJQuly1fsqmtu4fckj31bg0qoaf5.jpg\" alt=\"\"/> */}\n                    {classResultImgUrl ?\n                      <div className=\"img-container\">\n                      {classResultImgUrl && (\n                        <img\n                          className=\"img\"\n                          src={classResultImgUrl}\n                          alt=\"classResultImgUrl\"\n                        />\n                      )}\n                     </div>  :''\n                    } \n                    <div className=\"jia\">\n                    <img src={jia} alt=\"\" className=\"fuhao\"/>\n\n                    <div className=\"app\">\n                          <div className=\"half-area\">\n                            <label className=\"upload-input-label\">\n                              <input\n                                type=\"file\"\n                                accept=\"image/jpeg,image/jpg,image/png\"\n                                className=\"base-upload-input\"\n                                onChange={this.handleClassFileChange}\n                              />\n                            </label>\n                          </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n          </div>\n     \n          <div className=\"btn\">\n              {classModalVisible && (\n              <ClassCropperModal\n                uploadedImageFile={classModalFile}\n                onClose={() => {\n                  this.setState({ classModalVisible: false })\n                }}\n                onSubmit={this.handleGetResultImgUrl('classResultImgUrl')}\n              />\n            )}\n            <button className=\"buttom\" onClick={this.submitAll}><span>提交作品</span></button>\n            <button className=\"right-btn buttom isShow\" onClick={this.newPage}><span>返回编辑</span></button>\n          </div>\n      </div>\n    );\n  }\n}\n\nexport default Display;\n"]},"metadata":{},"sourceType":"module"}