{"version":3,"sources":["images/dui.png","images/add.png","components/class-cropper-modal/class-cropper-modal.jsx","api/api.js","pages/display/display.jsx"],"names":["module","exports","ClassCropperModal","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","handleSubmit","state","submitting","console","log","cropper","getCroppedCanvas","toBlob","_ref","asyncToGenerator","regenerator_default","a","mark","_callee","blob","wrap","_context","prev","next","onSubmit","onClose","stop","_x","apply","arguments","src","_this2","fileReader","FileReader","onload","e","dataURL","target","result","setState","readAsDataURL","uploadedImageFile","_this3","react_default","createElement","className","react_cropper_default","ref","viewMode","zoomable","aspectRatio","guides","preview","onClick","Component","http","showLoading","hideLoading","setTokenInHeader","json_to_get","jsonObj","keys","map","key","encodeURIComponent","join","get_to_json","sstr","replace","fetchAction","url","fetchConfig","that","Promise","resolve","reject","fetch","then","response","ok","json","status","catch","err","finally","get","params","headers","headerObj","paramsArray","forEach","push","search","undefined","method","post","formDataObj","mode","body","postUpload","formdata","uploadReq","Request","tsIcon","require","jia","MAX_FILE_SIZE","Display","handleChange","event","title","value","allContent","content","checkboxOption","choose","dataURLtoFile","dataurl","filename","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","File","type","newPage","window","open","concat","submitAll","titleTxt","titleContent","info","classResultImgUrl","file","classModalFile","id","data","history","Modal","onOk","handleClassFileChange","files","size","classModalVisible","handleGetResultImgUrl","str","URL","createObjectURL","defineProperty","base64","urlRouter","location","theRequest","indexOf","strs","substr","i","unescape","_this$state","name","onChange","cols","rows","placeholder","alt","accept","class_cropper_modal_class_cropper_modal"],"mappings":"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","file":"static/js/4.2e4a1489.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAwFJREFUWAntVktoE1EUPS8fMykqKCoIfqALdVEQrFLwB0Fq2ijFLkUUwZUUwVVBd7pQcCPuCorgqnUlIk1/ASkJXSnFhYK40u7Uha2QZJomz/NCBt68zHQSsc3CGRjeu+e+d++Z8z53gPAJFQgVCBUIFQgVCBXYSAVkAdvkNHb65Yj4OTYDl29h2ct4bVcxT5J7vXJ2jCDJxewSXkogxbeHJAvlHLpNkh0hKCVEuYjnbIccQiTZLVep5Dt0OZhqO0LQnsIT5r6qE2n074vjKOp4TDc2o1/K4h6Vu2XmEhGMWoN42oSbwEba5Sxuk9zjphwRPEwO4m4TTkB4gRuBlaZwXcj6vnPlFAJjVgY3/XK2tAftGfSoU+cXJAjnnhsWNTxTh8M1VmAiMYgRF2YYgQRXZ9Ar17DAK+GVureM+YEmlTtHYuM8pVF9MJXLWntwjW1Nx82++4sML5U7UltDnvCuuktgngyHRAYrxlBPkx/XV6siR4JbjQF5awfS4iRKBt5k+hJUJai8gk+Q2KfP4oT3iS4MiBR+6rjZV9uC5OY531XGqNhiIo6U6MeyOcfL9l1icRq/SeYBX9cScKl67SLyMusmrgdXFYHkZj3IfU6AyrVITsX0VdBJyA1+mUv0gm/cwRrtVxFHv3UeX3Rc1VRVtlRl0HFmWrKiOCXSWHLhAYavgs48nrJx1pthfom5Xw7KCvKr0zjqjFV/JSQ360HuB5e2v11yKm6ggk7yygzOVqt4QyW3O1gjwK+owMVYEh9YX3PE+lx+gWWqkNqSwaKOt9pvmaAKSLWOVWuY5t7arSdgkKIU+Ej8hIGXolGk4wP1m0B3tdxvi6CKWp7CYao4RzL718vCJa1wfS6xvmbXGxfka5ugCijncMCuYI5ED3klYNAai/8V7t8JL387WOAh8QrGa+JbIooz6k7z8hMb+RfkVOy/Iqgm8kR+Vxcul7GgbOeJRHDHuoAxx+54KxeQ5G9UtjQJWZ7Eo44T8iLA3/Q4fwpuePlCLFQgVOB/V+APyizm4hEpP9UAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAM9JREFUWAntl7ENwlAMRO9QahoqRmADChiCRVJAkxHS0DAI7ABMwB40LGAygL9k6YRIcS7tO8t6sqX/CTH643AN4JC1IfG8nMd9VqvmFlXhv3QeUCVvgiaoElD93kETVAmofu+gCaoEVD/70/BQmgS4QcQq60HwA8Yrq1VzXQR2VXGum56rjQjEEmJ/X3EDbjltgmVUDeHsCXYEbo3hi2lup2tdp2LyzYh7Wismp/m08L9Y4/d79+yPxAOqS2CCJqgSUP3eQRNUCah+76BK8Asp7SGeJumpSQAAAABJRU5ErkJggg==\"","import React, { Component } from 'react';\nimport PropTypes from 'prop-types'\nimport Cropper from 'react-cropper' // 引入Cropper\nimport 'cropperjs/dist/cropper.css' // 引入Cropper对应的css\nimport './class-cropper-modal.scss'\n// export default class ClassCropperModal extends Component\n\nclass ClassCropperModal extends Component {\n  static propTypes = {\n    uploadedImageFile: PropTypes.object.isRequired,\n    onClose: PropTypes.func.isRequired,\n    onSubmit: PropTypes.func.isRequired,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      src: null\n    }\n  }\n\n  componentDidMount() {\n    const fileReader = new FileReader()\n    fileReader.onload = e => {\n      const dataURL = e.target.result\n      this.setState({ src: dataURL })\n    }\n\n    fileReader.readAsDataURL(this.props.uploadedImageFile)\n  }\n\n  handleSubmit = () => {\n    if (!this.state.submitting) {\n      // let url = `/homepage_images` // 你要上传的url\n      // 拿到文件名\n      // let filename = this.props.uploadedImageFile.name\n\n      console.log('正在上传图片')\n      // TODO: 这里可以尝试修改上传图片的尺寸\n      this.cropper.getCroppedCanvas().toBlob(async blob => {\n        // // 创造提交表单数据对象\n        // const formData = new FormData()\n        // // 添加要上传的文件\n        // formData.append('file', blob, filename)\n        // 提示开始上传 (因为demo没有后端server, 所以这里代码我注释掉了, 这里是上传到服务器并拿到返回数据的代码)\n        // this.setState({submitting: true})\n        // 上传图片\n        // const resp = await http.post(url, formData)\n        // 拿到服务器返回的数据(resp)\n        // console.log(resp)\n        // 提示上传完毕\n        // this.setState({submitting: false})\n\n        //把选中裁切好的的图片传出去\n        this.props.onSubmit(blob);\n\n        // 关闭弹窗\n        this.props.onClose()\n      })\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"class-cropper-modal\">\n        <div className=\"modal-panel\">\n          <div className=\"cropper-container-container\">\n            <div className=\"cropper-container\">\n              <Cropper\n                src={this.state.src}\n                className=\"cropper\"\n                ref={cropper => (this.cropper = cropper)}\n                // Cropper.js options\n                viewMode={1}\n                zoomable={false}\n                aspectRatio={1} // 固定为1:1  可以自己设置比例, 默认情况为自由比例\n                guides={false}\n                preview=\".cropper-preview\"\n              />\n            </div>\n            <div className=\"preview-container\">\n              <div className=\"cropper-preview\" />\n            </div>\n          </div>\n          <div className=\"button-row\">\n            <div className=\"submit-button\" onClick={this.handleSubmit}>\n              点击提交\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\n\nexport default ClassCropperModal;\n","/**\n *  基于fetch 在浏览器中发送请求库的封装\n */\nexport const\nhttp = {\n    // 弹出\"菊花\"效果\n    showLoading: function () {\n        // Toast.loading(\"请求中\", 5000, function () {\n        //     console.log('close');\n        // }, true);\n    },\n    // 关闭 \"菊花\" 效果\n    hideLoading: function () {\n        // Toast.hide();\n    },\n    // 在header中添加token\n    setTokenInHeader: function () {\n\n    },\n    // json 转为 get请求的字符串\n    json_to_get: function (jsonObj) {\n        return Object.keys(jsonObj).map(function (key) {\n            // body...\n            return encodeURIComponent(key) + \"=\" + encodeURIComponent(jsonObj[key]);\n        }).join(\"&\");\n    },\n    // get 请求字符串转为json\n    get_to_json: function (sstr) {\n        sstr = sstr.replace(/&/g, '\",\"').replace(/=/g, '\":\"');\n        sstr = '{\"' + sstr + '\"}';\n    },\n    fetchAction: function (url, fetchConfig) {\n        var that = this;\n        return new Promise(function (resolve, reject) {\n            fetch(url, fetchConfig)\n            // then方法返回的是一个新的Promise实例（注意，不是原来那个Promise实例）。因此可以采用链式写法，即then方法后面再调用另一个then方法。\n            // 第一个then的response返回的是 服务器响应的信息 —— 包括 header content-type body 等信息\n            // 只要不是后台报错，响应都是成功的，比如 404 ，403， 500等是成功返回\n            .then(function (response) {\n                // 如果是成功返回\n                if (response.ok) {\n                    // 这个函数返回的是接口响应的值，执行后面的then 方法\n                    return response.json();\n                } else {\n                    // 后台报错，执行后面的catch方法\n                    reject({\n                        status: response.status\n                    })\n                }\n            })\n            .then(function (response) {\n                resolve(response);\n            })\n            .catch (function (err) {\n                reject({\n                    status: -1\n                });\n            })\n            // 无论成功和失败，都需要执行该方法，用来关闭菊花效果\n            .finally(function () {\n                that.hideLoading();\n            })\n        });\n    },\n\n    // blob(url,index){\n    //     //请求并且传递音乐名称\n    //     fetch(url,{\n    //         method: 'get',\n    //         responseType: 'blob'\n    //     }).then(res => {     \n    //         return res.blob();\n    //     }).then(blob => {\n            \n    //     })\n    // },\n\n    /**\n     * 基于 fetch 封装的 GET请求\n     * @param url\n     * @param params {}\n     * @param headers\n     * @returns {Promise}\n     */\n    get: function (url, params, headers) {\n        var that = this;\n        this.showLoading();\n        var headerObj = {};\n        if (params) {\n            var paramsArray = [];\n            //encodeURIComponent\n            Object.keys(params).forEach(function (key) {\n                paramsArray.push(key + '=' + params[key])\n            });\n            if (url.search(/\\?/) === -1) {\n                url += '?' + paramsArray.join('&')\n            } else {\n                url += '&' + paramsArray.join('&')\n            }\n        }\n        // 判断用户是否添加了值\n        if (headers === undefined) {\n            headerObj = {};\n        } else {\n            headerObj = headers;\n        }\n        // 设置token在header中\n        this.setTokenInHeader(headerObj);\n\n        var fetchConfig = {\n            method: 'GET',\n            headers: headerObj,\n        }\n        return that.fetchAction(url, fetchConfig);\n    },\n    /**\n     * 基于 fetch 封装的 POST请求  FormData 表单数据\n     * @param url\n     * @param formData\n     * @param headers\n     * @returns {Promise}\n     */\n    post: function (url, params, headers) {\n        var that = this;\n        this.showLoading();\n        var formDataObj = null; // 传递的参数\n        var headerObj = {}; // 设置请求头对象\n        if (params === undefined) {\n            formDataObj = \"\";\n        } else {\n            // 判断传递过来的是否是对象，如果是JSON 对象，需要序列化JSON数据，后台才能接受的刀\n            if (params instanceof Object) {\n                formDataObj = that.json_to_get(params)\n            } else { // 如果不是JSON，则直接使用用户传递过来的值\n                formDataObj = params;\n            }\n        }\n        // 判断用户是否添加了值\n        if (headers === undefined) {\n            headerObj['Content-type'] = 'application/x-www-form-urlencoded';\n        } else {\n            headerObj = headers;\n        }\n        // 设置token在header中\n        this.setTokenInHeader(headerObj);\n        var fetchConfig = {\n            method: 'POST',\n            mode: 'cors',\n            headers: headerObj,\n            body: formDataObj,\n        };\n        return that.fetchAction(url, fetchConfig);\n    },\n    postUpload: function (url, formdata, headers) {\n        var that = this;\n        this.showLoading();\n        var uploadReq = new Request('http://localhost:3000/fetch/upload', { //url为服务器接口URL\n            method: \"POST\",\n            body: formdata\n        });\n        return new Promise(function (resolve, reject) {\n            fetch(uploadReq)\n            // then方法返回的是一个新的Promise实例（注意，不是原来那个Promise实例）。因此可以采用链式写法，即then方法后面再调用另一个then方法。\n            // 第一个then的response返回的是 服务器响应的信息 —— 包括 header content-type body 等信息\n            // 只要不是后台报错，响应都是成功的，比如 404 ，403等是成功返回\n                .then(function (response) {\n                    // 如果是成功返回\n                    if (response.ok) {\n                        // response.json读取服务器发来的JSON数据，response.json返回Promise，所以可以链式调用.then方法\n                        return response.json();\n                    } else {\n                        // 后台报错，执行后面的catch方法\n                        reject({\n                            status: response.status\n                        })\n                    }\n                })\n                .then(function (response) {\n                    resolve(response);\n                })\n                .catch (function (err) {\n                    reject({\n                        status: -1\n                    });\n                })\n                // 无论成功和失败，都需要执行该方法，用来关闭菊花效果\n                .finally(function () {\n                    that.hideLoading();\n                })\n        });\n    }\n};\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types'\nimport ClassCropperModal from '../../components/class-cropper-modal/class-cropper-modal'\nimport { http } from'../../api/api'\nimport { Modal } from 'antd';\nimport 'antd/dist/antd.css';\nimport './display.scss';\nconst tsIcon = require('../../images/dui.png')\nconst jia = require('../../images/add.png')\nconst MAX_FILE_SIZE = 5 * 1024 * 1024 // 文件最大限制为5M\n\nclass Display extends Component {\n  static propTypes= {\n    classModalVisible: PropTypes.bool,\n    classModalFile: PropTypes.bool,\n    classResultImgUrl: PropTypes.string,\n    title: PropTypes.string,\n    choose: PropTypes.string,\n    content: PropTypes.string,\n    titleTxt:PropTypes.string,\n    titleContent:PropTypes.string,\n  }\n\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      classModalVisible: false,\n      classModalFile: null,\n      classResultImgUrl: null,\n      title: '',\n      choose:'0',\n      content:'',\n      titleTxt:'无内容',\n      titleContent: '无内容',\n      url:'',\n      id:'',\n      base64:''\n    }\n  }\n\n  componentDidMount () {\n    //获取路由参数\n    let urlRouter = this.props.location.search;\n    let  theRequest = {};\n    if (urlRouter.indexOf(\"?\") !== -1) {\n            let strs = urlRouter.substr(1);\n            strs = strs.split(\"&\");\n            for(let i = 0; i < strs.length; i ++) {\n            theRequest[strs[i].split(\"=\")[0]] = unescape(strs[i].split(\"=\")[1]);\n        }\n    }\n    this.setState({\n      id : theRequest.id,\n      url : theRequest.url\n    });\n  }\n\n  handleChange= (event) =>{\n      this.setState({\n        title: event.target.value\n      })\n  }\n\n  allContent= (event) =>{\n    this.setState({\n      content: event.target.value\n    })\n  }\n\n  checkboxOption= (event) =>{\n      this.setState({\n        choose:event.target.value\n      });\n  }\n\n  dataURLtoFile=(dataurl, filename) =>{//将base64转换为文件\n    console.log(dataurl,'-=-=-=-')\n    var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],\n        bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\n    while(n--){\n        u8arr[n] = bstr.charCodeAt(n);\n    }\n    return new File([u8arr], filename, {type:mime});\n  }\n\n  newPage= () =>{\n    window.open(`http://127.0.0.1:8601?type=3&autoPlay=1&url=${this.state.url}`)\n  }\n\n  submitAll = () =>{\n    if(this.state.content ===''){\n      this.info()\n      return\n    }\n    if(this.state.title ===''){\n      this.setState({\n        titleTxt : '无标题',\n        titleContent : '请输入标题'\n      });\n      this.info()\n      return\n    }\n    if(this.state.classResultImgUrl ===null){\n      this.setState({\n        titleTxt : '无封面图片',\n        titleContent : '请上传封面图片'\n      });\n      this.info()\n      return\n    }\n    // let _this = this\n    // let filedata = ''\n    // let dataurl = ''\n    // let reader = new FileReader();\n    // reader.readAsDataURL(this.state.classModalFile);\n    // reader.onload = function (e){ \n    //     //  filedata= this.result.substring(this.result.indexOf(',')+1);\n    //      filedata= this.result;\n    //      console.log(filedata,'-=-=-=-')\n    //      dataurl =  this.result.substring;\n    //      let a = _this.dataURLtoFile(filedata)\n    //      console.log(a,'-=-=-')\n    // }\n\n    http.post('http://kejiadmin.qbitai.com/index.php?r=publish/preview',{\n      file:this.state.classModalFile,\n      id:this.state.id,\n      classResultImgUrl: this.state.classResultImgUrl,\n      title: this.state.title,\n      choose:this.state.choose,\n      content:this.state.content,\n    },).then(\n        data => {\n          this.props.history.push( `/showVideo/${this.state.url}`)\n        }\n      )\n    .catch(err => console.log(err)) \n  }\n\n  info =() => {\n    Modal.info({\n      title: this.state.titleTxt,\n      content: (\n        <div>\n          <p>{this.state.titleContent}</p>\n        </div>\n      ),\n      onOk() {},\n    });\n  }\n\n  handleClassFileChange = e => {\n    const file = e.target.files[0]\n    if (file) {\n      if (file.size <= MAX_FILE_SIZE) {\n        this.setState(\n          {\n            classModalFile: file // 先把上传的文件暂存在state中\n          },\n          () => {\n            this.setState({\n              classModalVisible: true // 然后弹出modal\n            })\n          }\n        )\n      } else {\n        console.log('文件过大')\n      }\n    }\n  }\n\n  handleGetResultImgUrl = key => blob => {\n    const str = URL.createObjectURL(blob)\n    this.setState({\n      [key]: str\n    })\n  }\n\n  render() {\n    const {\n      classModalVisible,\n      classModalFile,\n      classResultImgUrl\n    } = this.state\n    return (\n      <div className=\"content\">\n          <div className=\"con-box\">\n              <span className=\"fa\">发布作品</span>\n              <div className=\"line\"></div>\n              <div className=\"flex-box\">\n                <div className=\"production\">\n                  <div className=\"zuo\">作品名称</div>\n                  <input type=\"text\" className=\"inputText\"  name='title' value={this.state.title}  onChange={this.handleChange} />\n                  <div className=\"explain\">作品介绍与操作说明</div>\n                  <textarea  id=\"\" cols=\"30\" rows=\"10\" className=\"textAll\" placeholder=\"这里可以向大家介绍你的作品～\" name='content' value={this.state.content}  onChange={this.allContent} ></textarea>\n                  <div className=\"select\">\n                    <label className=\"left\">\n                        <input type=\"checkbox\" className=\"hidden-input\" name='choose'  value='0' onChange={this.checkboxOption}/>\n                        <span className=\"your style about checkbox\" ></span>\n                        {this.state.choose ==='0' ? <img src={tsIcon} className=\"dui\" alt=\"\"/> : ''}\n                    </label>\n                    <div className=\"share\">公开分享</div>\n\n                    <label className=\"left\">\n                        <input type=\"checkbox\" className=\"hidden-input\" name='choose' value='1'  onChange={this.checkboxOption}/>\n                        <span className=\"your style about checkbox\"></span>\n                        {this.state.choose=== '1' ? <img src={tsIcon} className=\"dui\" alt=\"\"/> : ''}\n                    </label>\n                    <div className=\"share\">允许查看源代码</div>\n                  </div>\n                </div>\n                <div className=\"cover\">\n                  <div className=\"zuo\">作品封面</div>\n                  <div className=\"imgAll\">\n                    {/* <img className=\"imageWh\" src=\"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1561543101261&di=9e8f50486a2ab5d4c527800b3e224fbf&imgtype=0&src=http%3A%2F%2Fwx4.sinaimg.cn%2Fwap720%2F006JOJQuly1fsqmtu4fckj31bg0qoaf5.jpg\" alt=\"\"/>\n                    <img className=\"imageWh\" src=\"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1561543101261&di=9e8f50486a2ab5d4c527800b3e224fbf&imgtype=0&src=http%3A%2F%2Fwx4.sinaimg.cn%2Fwap720%2F006JOJQuly1fsqmtu4fckj31bg0qoaf5.jpg\" alt=\"\"/>\n                    <img className=\"imageWh\" src=\"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1561543101261&di=9e8f50486a2ab5d4c527800b3e224fbf&imgtype=0&src=http%3A%2F%2Fwx4.sinaimg.cn%2Fwap720%2F006JOJQuly1fsqmtu4fckj31bg0qoaf5.jpg\" alt=\"\"/> */}\n                    {classResultImgUrl ?\n                      <div className=\"img-container\">\n                      {classResultImgUrl && (\n                        <img\n                          className=\"img\"\n                          src={classResultImgUrl}\n                          alt=\"classResultImgUrl\"\n                        />\n                      )}\n                     </div>  :''\n                    } \n                    <div className=\"jia\">\n                    <img src={jia} alt=\"\" className=\"fuhao\"/>\n\n                    <div className=\"app\">\n                          <div className=\"half-area\">\n                            <label className=\"upload-input-label\">\n                              <input\n                                type=\"file\"\n                                accept=\"image/jpeg,image/jpg,image/png\"\n                                className=\"base-upload-input\"\n                                onChange={this.handleClassFileChange}\n                              />\n                            </label>\n                          </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n          </div>\n     \n          <div className=\"btn\">\n              {classModalVisible && (\n              <ClassCropperModal\n                uploadedImageFile={classModalFile}\n                onClose={() => {\n                  this.setState({ classModalVisible: false })\n                }}\n                onSubmit={this.handleGetResultImgUrl('classResultImgUrl')}\n              />\n            )}\n            <button className=\"buttom\" onClick={this.submitAll}><span>提交作品</span></button>\n            <button className=\"right-btn buttom isShow\" onClick={this.newPage}><span>返回编辑</span></button>\n          </div>\n      </div>\n    );\n  }\n}\n\nexport default Display;\n"],"sourceRoot":""}